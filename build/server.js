!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=2)}([function(e,n){e.exports=require("config")},function(e,n){e.exports=require("express")},function(e,n,t){"use strict";n.__esModule=!0;var o=t(3),r=t(1),i=t(4),s=t(17),a=t(18),c=o.default.port||3e3,u=r();u.use(r.json()),u.use(r.urlencoded({extended:!0})),o.default.enableAccessLogs&&u.use(s("tiny")),u.use(a()),u.use(r.static("public")),i.default(u),u.listen(c,(function(){console.log("server started at http://localhost:"+c)}))},function(e,n,t){"use strict";n.__esModule=!0;var o=t(0),r={name:o.get("name"),mongodbConnectionString:o.get("mongodbConnectionString"),enableAccessLogs:o.get("enableAccessLogs"),basePath:o.get("basePath"),port:o.get("port")};n.default=r},function(e,n,t){"use strict";n.__esModule=!0;var o=t(5),r=t(14);n.default=function(e){e.use("/api/users",o.router),e.use("/",r)}},function(e,n,t){"use strict";var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,a)}c((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(e,s)}catch(e){i=[6,e],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};n.__esModule=!0,n.router=void 0;var i=t(1).Router();n.router=i;var s=t(6).logger,a=t(8),c=a.ADMIN,u=a.BASE,l=t(9),f=t(10),d=t(13);i.get("/",l([c,u]),(function(e,n){return o(void 0,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return s.info("You get all users!"),[4,f.getUsers()];case 1:return e=t.sent(),n.send(e),[2]}}))}))})),i.get("/:id",l([c,u]),(function(e,n){return o(void 0,void 0,void 0,(function(){var t;return r(this,(function(o){switch(o.label){case 0:return[4,f.getUser(e.params.id)];case 1:if(!(t=o.sent()))throw new d("The user not found.",404);return n.send(t),[2]}}))}))}))},function(e,n,t){const{createLogger:o,transports:r,format:i}=t(7),s=[new r.File({level:"info",filename:"logs/winston/errors.log",maxsize:3e7,tailable:!0,maxFiles:3}),new r.Console({format:i.simple()})],a=[new r.File({level:"info",filename:"logs/winston/info.log",maxsize:3e7,tailable:!0,maxFiles:3}),new r.Console({format:i.simple()})],c=o({format:i.combine(i.printf(e=>e.message)),transports:s}),u=o({format:i.combine(i.printf(e=>e.message)),transports:a});e.exports={logger:{info(e){u.info(e+" | "+(new Date).toISOString())},error(e){c.error(e.message,{date:(new Date).toLocaleString(),statusCode:e.statusCode||"500",url:req.url||"",stack:e.stack})}}}},function(e,n){e.exports=require("winston")},function(e,n){e.exports={ADMIN:"ADMIN",BASE:"BASE"}},function(e,n){e.exports=function(e){return function(n,t,o){console.log("Authenticating...",e),o()}}},function(e,n,t){const o=t(11);e.exports=new class{constructor(){}async getUsers(){return await o.User.find().limit(10)}async getUser(e){return await o.User.findOne({_id:e})}async createUser(e){e.creationDate=Date.now();let n=new o.User(e);return await n.save()}async updateUser(e,n){return n.modificationDate=Date.now(),await o.User.updateOne({_id:e},n)}async deleteUser(e){return await o.User.deleteOne({_id:e})}}},function(e,n,t){const o=t(12),r=t(0).mongodbConnectionString||"mongodb://localhost/";console.log(r);db=o.connection,db.on("connecting",(function(){console.log("connecting to MongoDB...")})),db.on("error",(function(e){console.log("Error in MongoDb connection: "+e)})),db.on("connected",(function(){console.log("MongoDB connected!")})),db.once("open",(function(){console.log("MongoDB connection opened!")})),db.on("reconnected",(function(){console.log("MongoDB reconnected!")})),db.on("disconnected",(function(){console.log("MongoDB disconnected!")})),o.connect(r+"AuthProvider",{reconnectTries:Number.MAX_VALUE,reconnectInterval:5e3,useNewUrlParser:!0});const i=new o.Schema({firstName:String,lastName:String,email:String,isActive:Boolean,modificationDate:{type:Date,default:null},creationDate:{type:Date}}),s=o.model("User",i,"users");e.exports={User:s}},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=class extends Error{constructor(e,n){super(e),this.statusCode=n||500}}},function(e,n,t){const o=t(1);var r=t(15);const i=o.Router();var s=t(16);const a=t(0);i.get("/",(e,n)=>{var t=r.readFileSync(`./${a.basePath}views/home.html`,"utf8"),o=s.to_html(t,{pagePosTitle:"titolo posizionamento",pageTitle:"titolo pagina",pageDescription:"titolo desrizione",link:{url:"https://www.google.it/",label:"link a google",target:"_blank"}});n.send(o)}),e.exports=i},function(e,n){e.exports=require("fs")},function(e,n){e.exports=require("mustache")},function(e,n){e.exports=require("morgan")},function(e,n){e.exports=require("helmet")}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiY29uZmlnXCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZXhwcmVzc1wiIiwid2VicGFjazovLy8uL3NyYy9zZXJ2ZXIudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbmZpZy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvcm91dGVzL2luZGV4LnRzIiwid2VicGFjazovLy8uL3NyYy9yb3V0ZXMvdXNlcnMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvcmUvbG9nZ2VyLmpzIiwid2VicGFjazovLy9leHRlcm5hbCBcIndpbnN0b25cIiIsIndlYnBhY2s6Ly8vLi9zcmMvY29yZS9yb2xlcy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvbWlkZGxld2FyZS9hdXRoUHJvdmlkZXIuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3NlcnZpY2VzL3VzZXJzU2VydmljZS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvc3RvcmUvZGJDb250ZXh0LmpzIiwid2VicGFjazovLy9leHRlcm5hbCBcIm1vbmdvb3NlXCIiLCJ3ZWJwYWNrOi8vLy4vc3JjL3N0b3JlL21vZGVscy9jb21tb24tbW9kZWxzLmpzIiwid2VicGFjazovLy8uL3NyYy9yb3V0ZXMvaG9tZS5qcyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJmc1wiIiwid2VicGFjazovLy9leHRlcm5hbCBcIm11c3RhY2hlXCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwibW9yZ2FuXCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiaGVsbWV0XCIiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJyZXF1aXJlIiwiUE9SVCIsInBvcnQiLCJhcHAiLCJleHByZXNzIiwidXNlIiwianNvbiIsInVybGVuY29kZWQiLCJleHRlbmRlZCIsImVuYWJsZUFjY2Vzc0xvZ3MiLCJtb3JnYW4iLCJoZWxtZXQiLCJzdGF0aWMiLCJsaXN0ZW4iLCJjb25zb2xlIiwibG9nIiwiY29uZmlnIiwibm9kZUNvbmZpZyIsIm1vbmdvZGJDb25uZWN0aW9uU3RyaW5nIiwiYmFzZVBhdGgiLCJob21lUm91dGUiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJsb2dnZXIiLCJBRE1JTiIsIkJBU0UiLCJhdXRoUHJvdmlkZXIiLCJ1c2Vyc1NlcnZpY2UiLCJIdHRwRXJyb3IiLCJyZXEiLCJyZXMiLCJpbmZvIiwiZ2V0VXNlcnMiLCJyZXN1bHQiLCJzZW5kIiwiZ2V0VXNlciIsInBhcmFtcyIsImlkIiwiY3JlYXRlTG9nZ2VyIiwidHJhbnNwb3J0cyIsImZvcm1hdCIsInRyYW5zcG9ydEVycm9yIiwiRmlsZSIsImxldmVsIiwiZmlsZW5hbWUiLCJtYXhzaXplIiwidGFpbGFibGUiLCJtYXhGaWxlcyIsIkNvbnNvbGUiLCJzaW1wbGUiLCJ0cmFuc3BvcnRJbmZvIiwibG9nZ2VyRXJyb3IiLCJjb21iaW5lIiwicHJpbnRmIiwiZXJyIiwibWVzc2FnZSIsImxvZ2dlckluZm8iLCJEYXRlIiwidG9JU09TdHJpbmciLCJlcnJvciIsImRhdGUiLCJ0b0xvY2FsZVN0cmluZyIsInN0YXR1c0NvZGUiLCJ1cmwiLCJzdGFjayIsInZhbGlkUm9sZXMiLCJuZXh0IiwiZGJDb250ZXh0IiwiVXNlciIsImZpbmQiLCJsaW1pdCIsImZpbmRPbmUiLCJfaWQiLCJ1c2VyIiwiY3JlYXRpb25EYXRlIiwibm93IiwiX3VzZXIiLCJzYXZlIiwibW9kaWZpY2F0aW9uRGF0ZSIsInVwZGF0ZU9uZSIsImRlbGV0ZU9uZSIsIm1vbmdvb3NlIiwiY29ubmVjdGlvblN0cmluZyIsImRiIiwiY29ubmVjdGlvbiIsIm9uIiwib25jZSIsImNvbm5lY3QiLCJyZWNvbm5lY3RUcmllcyIsIk51bWJlciIsIk1BWF9WQUxVRSIsInJlY29ubmVjdEludGVydmFsIiwidXNlTmV3VXJsUGFyc2VyIiwidXNlclNjaGVtYSIsIlNjaGVtYSIsImZpcnN0TmFtZSIsIlN0cmluZyIsImxhc3ROYW1lIiwiZW1haWwiLCJpc0FjdGl2ZSIsIkJvb2xlYW4iLCJ0eXBlIiwiZGVmYXVsdCIsIm1vZGVsIiwiRXJyb3IiLCJzdXBlciIsInRoaXMiLCJmcyIsIm11c3RhY2hlIiwicGFnZSIsInJlYWRGaWxlU3luYyIsImh0bWwiLCJ0b19odG1sIiwicGFnZVBvc1RpdGxlIiwicGFnZVRpdGxlIiwicGFnZURlc2NyaXB0aW9uIiwibGluayIsImxhYmVsIiwidGFyZ2V0Il0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0RHLEVBQU9FLEdBQUksRUFHSkYsRUFBT0QsUUFLZkYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNBQVNSLEVBQVNTLEVBQU1DLEdBQzNDWixFQUFvQmEsRUFBRVgsRUFBU1MsSUFDbENHLE9BQU9DLGVBQWViLEVBQVNTLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVosRUFBb0JrQixFQUFJLFNBQVNoQixHQUNYLG9CQUFYaUIsUUFBMEJBLE9BQU9DLGFBQzFDTixPQUFPQyxlQUFlYixFQUFTaUIsT0FBT0MsWUFBYSxDQUFFQyxNQUFPLFdBRTdEUCxPQUFPQyxlQUFlYixFQUFTLGFBQWMsQ0FBRW1CLE9BQU8sS0FRdkRyQixFQUFvQnNCLEVBQUksU0FBU0QsRUFBT0UsR0FFdkMsR0FEVSxFQUFQQSxJQUFVRixFQUFRckIsRUFBb0JxQixJQUMvQixFQUFQRSxFQUFVLE9BQU9GLEVBQ3BCLEdBQVcsRUFBUEUsR0FBOEIsaUJBQVZGLEdBQXNCQSxHQUFTQSxFQUFNRyxXQUFZLE9BQU9ILEVBQ2hGLElBQUlJLEVBQUtYLE9BQU9ZLE9BQU8sTUFHdkIsR0FGQTFCLEVBQW9Ca0IsRUFBRU8sR0FDdEJYLE9BQU9DLGVBQWVVLEVBQUksVUFBVyxDQUFFVCxZQUFZLEVBQU1LLE1BQU9BLElBQ3RELEVBQVBFLEdBQTRCLGlCQUFURixFQUFtQixJQUFJLElBQUlNLEtBQU9OLEVBQU9yQixFQUFvQlUsRUFBRWUsRUFBSUUsRUFBSyxTQUFTQSxHQUFPLE9BQU9OLEVBQU1NLElBQVFDLEtBQUssS0FBTUQsSUFDOUksT0FBT0YsR0FJUnpCLEVBQW9CNkIsRUFBSSxTQUFTMUIsR0FDaEMsSUFBSVMsRUFBU1QsR0FBVUEsRUFBT3FCLFdBQzdCLFdBQXdCLE9BQU9yQixFQUFnQixTQUMvQyxXQUE4QixPQUFPQSxHQUV0QyxPQURBSCxFQUFvQlUsRUFBRUUsRUFBUSxJQUFLQSxHQUM1QkEsR0FJUlosRUFBb0JhLEVBQUksU0FBU2lCLEVBQVFDLEdBQVksT0FBT2pCLE9BQU9rQixVQUFVQyxlQUFlMUIsS0FBS3VCLEVBQVFDLElBR3pHL0IsRUFBb0JrQyxFQUFJLEdBSWpCbEMsRUFBb0JBLEVBQW9CbUMsRUFBSSxHLGdCQ2xGckRoQyxFQUFPRCxRQUFVa0MsUUFBUSxXLGNDQXpCakMsRUFBT0QsUUFBVWtDLFFBQVEsWSw2Q0NBekIsV0FDQSxPQUNBLE9BQ0EsUUFDQSxRQUVNQyxFQUFPLFVBQU9DLE1BQVEsSUFDdEJDLEVBQU1DLElBRVpELEVBQUlFLElBQUlELEVBQVFFLFFBQ2hCSCxFQUFJRSxJQUFJRCxFQUFRRyxXQUFXLENBQUVDLFVBQVUsS0FFbkMsVUFBT0Msa0JBQ1ROLEVBQUlFLElBQUlLLEVBQU8sU0FFakJQLEVBQUlFLElBQUlNLEtBRVJSLEVBQUlFLElBQUlELEVBQVFRLE9BQU8sV0FFdkIsVUFBT1QsR0FFUEEsRUFBSVUsT0FBT1osR0FBTSxXQUNmYSxRQUFRQyxJQUFJLHNDQUF3Q2QsTyw2Q0N0QnRELFdBVU1lLEVBQWlCLENBQ3JCekMsS0FBTTBDLEVBQVdwQyxJQUFZLFFBQzdCcUMsd0JBQXlCRCxFQUFXcEMsSUFBWSwyQkFDaEQ0QixpQkFBa0JRLEVBQVdwQyxJQUFhLG9CQUMxQ3NDLFNBQVVGLEVBQVdwQyxJQUFZLFlBQ2pDcUIsS0FBTWUsRUFBV3BDLElBQVksU0FHL0IsVUFBZW1DLEcsNkNDbEJmLFdBQ01JLEVBQVksRUFBUSxJQUsxQixtQkFBeUJqQixHQUN2QkEsRUFBSUUsSUFBSSxhQUFjLFVBQ3RCRixFQUFJRSxJQUFJLElBQUtlLEssNDdDQ1BmLElBRU1DLEVBRk4sS0FFZUMsU0ErQ04sRUFBQUQsU0E3Q0QsSUFBQUUsRUFBVyxFQUFRLEdBQWlCLE9BQ3RDLEVBQWtCLEVBQVEsR0FBeEJDLEVBQUssUUFBRUMsRUFBSSxPQUNiQyxFQUFlLEVBQVEsR0FDdkJDLEVBQWUsRUFBUSxJQUV2QkMsRUFBWSxFQUFRLElBRTFCUCxFQUFPeEMsSUFBSSxJQUFLNkMsRUFBYSxDQUFDRixFQUFPQyxLQUFRLFNBQU9JLEVBQUtDLEdBQUcsMEMsd0RBRTdDLE9BRGJQLEVBQU9RLEtBQUssc0JBQ0MsR0FBTUosRUFBYUssWSxjQUE1QkMsRUFBUyxTQUNiSCxFQUFJSSxLQUFLRCxHLGNBRVhaLEVBQU94QyxJQUFJLE9BQVE2QyxFQUFhLENBQUNGLEVBQU9DLEtBQVEsU0FBT0ksRUFBS0MsR0FBRywwQyx3REFDaEQsU0FBTUgsRUFBYVEsUUFBUU4sRUFBSU8sT0FBT0MsSyxPQUNuRCxLQURJSixFQUFTLFVBQ0EsTUFBTSxJQUFJTCxFQUFVLHNCQUF1QixLLE9BRXhERSxFQUFJSSxLQUFLRCxHLCtCQ3JCWCxNQUFNLGFBQUVLLEVBQVksV0FBRUMsRUFBVSxPQUFFQyxHQUFXLEVBQVEsR0FFL0NDLEVBQWlCLENBQ25CLElBQUlGLEVBQVdHLEtBQUssQ0FDaEJDLE1BQU8sT0FDUEMsU0FBVSwwQkFDVkMsUUFBUyxJQUNUQyxVQUFVLEVBQ1ZDLFNBQVMsSUFFYixJQUFJUixFQUFXUyxRQUFRLENBQ25CUixPQUFRQSxFQUFPUyxZQUdqQkMsRUFBZ0IsQ0FDbEIsSUFBSVgsRUFBV0csS0FBSyxDQUNoQkMsTUFBTyxPQUNQQyxTQUFVLHdCQUNWQyxRQUFTLElBQ1RDLFVBQVUsRUFDVkMsU0FBUyxJQUViLElBQUlSLEVBQVdTLFFBQVEsQ0FDbkJSLE9BQVFBLEVBQU9TLFlBR2pCRSxFQUFjYixFQUFhLENBQzdCRSxPQUFRQSxFQUFPWSxRQUNYWixFQUFPYSxPQUFPQyxHQUFPQSxFQUFJQyxVQUU3QmhCLFdBQVlFLElBRVZlLEVBQWFsQixFQUFhLENBQzVCRSxPQUFRQSxFQUFPWSxRQUNYWixFQUFPYSxPQUFPdEIsR0FBUUEsRUFBS3dCLFVBRS9CaEIsV0FBWVcsSUFFaEJuRixFQUFPRCxRQUFVLENBQ2J5RCxPQUFRLENBQ0osS0FBS2dDLEdBQ0RDLEVBQVd6QixLQUFLd0IsRUFBVSxPQUFRLElBQUlFLE1BQU9DLGdCQUVqRCxNQUFNSixHQUNGSCxFQUFZUSxNQUFNTCxFQUFJQyxRQUFTLENBQzNCSyxNQUFNLElBQUlILE1BQU9JLGlCQUNqQkMsV0FBWVIsRUFBSVEsWUFBYyxNQUM5QkMsSUFBS2xDLElBQUlrQyxLQUFPLEdBQ2hCQyxNQUFPVixFQUFJVSxZLGNDaEQzQmpHLEVBQU9ELFFBQVVrQyxRQUFRLFksY0NJekJqQyxFQUFPRCxRQUpPLENBQ1YwRCxNQUFPLFFBQ1BDLEtBQU0sUyxjQ0ZWMUQsRUFBT0QsUUFBVSxTQUFzQm1HLEdBQ25DLE9BQU8sU0FBY3BDLEVBQUtDLEVBQUtvQyxHQUMzQnBELFFBQVFDLElBQUksb0JBQXFCa0QsR0FDakNDLE8sZ0JDRlIsTUFBTUMsRUFBWSxFQUFRLElBK0IxQnBHLEVBQU9ELFFBQVUsSUE3QmpCLE1BQ0UsZUFDQSxpQkFDRSxhQUFhcUcsRUFBVUMsS0FBS0MsT0FRekJDLE1BQU0sSUFFWCxjQUFlakMsR0FDYixhQUFhOEIsRUFBVUMsS0FBS0csUUFBUSxDQUFFQyxJQUFLbkMsSUFFN0MsaUJBQWtCb0MsR0FDaEJBLEVBQUtDLGFBQWVqQixLQUFLa0IsTUFDekIsSUFBSUMsRUFBUSxJQUFJVCxFQUFVQyxLQUFLSyxHQUMvQixhQUFhRyxFQUFNQyxPQUVyQixpQkFBa0J4QyxFQUFJb0MsR0FFcEIsT0FEQUEsRUFBS0ssaUJBQW1CckIsS0FBS2tCLFlBQ2hCUixFQUFVQyxLQUFLVyxVQUFVLENBQUVQLElBQUtuQyxHQUFNb0MsR0FFckQsaUJBQWtCcEMsR0FDaEIsYUFBYThCLEVBQVVDLEtBQUtZLFVBQVUsQ0FBRVIsSUFBS25DLE8sZ0JDN0JqRCxNQUFNNEMsRUFBVyxFQUFRLElBR25CQyxFQUZTLEVBQVEsR0FFU2hFLHlCQUEyQix1QkFDM0RKLFFBQVFDLElBQUltRSxHQVFaQyxHQUFLRixFQUFTRyxXQUNkRCxHQUFHRSxHQUFHLGNBQWMsV0FDbEJ2RSxRQUFRQyxJQUFJLCtCQUVkb0UsR0FBR0UsR0FBRyxTQUFTLFNBQVMxQixHQUN0QjdDLFFBQVFDLElBQUksZ0NBQWtDNEMsTUFFaER3QixHQUFHRSxHQUFHLGFBQWEsV0FDakJ2RSxRQUFRQyxJQUFJLHlCQUVkb0UsR0FBR0csS0FBSyxRQUFRLFdBQ2R4RSxRQUFRQyxJQUFJLGlDQUVkb0UsR0FBR0UsR0FBRyxlQUFlLFdBQ25CdkUsUUFBUUMsSUFBSSwyQkFFZG9FLEdBQUdFLEdBQUcsZ0JBQWdCLFdBQ3BCdkUsUUFBUUMsSUFBSSw0QkFHZGtFLEVBQVNNLFFBQVFMLEVBM0JGLGVBMkI2QixDQUMxQ00sZUFBZ0JDLE9BQU9DLFVBQ3ZCQyxrQkFBbUIsSUFDbkJDLGlCQUFpQixJQUluQixNQUFNQyxFQUFhLElBQUlaLEVBQVNhLE9BQU8sQ0FDckNDLFVBQVdDLE9BQ1hDLFNBQVVELE9BQ1ZFLE1BQU9GLE9BQ1BHLFNBQVVDLFFBQ1Z0QixpQkFBa0IsQ0FBRXVCLEtBQU01QyxLQUFNNkMsUUFBUyxNQUN6QzVCLGFBQWMsQ0FBRTJCLEtBQU01QyxRQUVsQlcsRUFBT2EsRUFBU3NCLE1BQU0sT0FBUVYsRUFBWSxTQUVoRDlILEVBQU9ELFFBQVUsQ0FDZnNHLFMsY0NsREZyRyxFQUFPRCxRQUFVa0MsUUFBUSxhLGNDQXpCakMsRUFBT0QsUUFBVSxjQUF3QjBJLE1BQ3JDLFlBQVlqRCxFQUFTTyxHQUNqQjJDLE1BQU1sRCxHQUNObUQsS0FBSzVDLFdBQVlBLEdBQWMsTyxnQkNIdkMsTUFBTTFELEVBQVUsRUFBUSxHQUN4QixJQUFJdUcsRUFBSyxFQUFRLElBQ2pCLE1BQU10RixFQUFTakIsRUFBUWtCLFNBQ3ZCLElBQUlzRixFQUFXLEVBQVEsSUFDdkIsTUFBTTVGLEVBQVMsRUFBUSxHQUV2QkssRUFBT3hDLElBQUksSUFBSyxDQUFDZ0QsRUFBS0MsS0FXcEIsSUFBSStFLEVBQU9GLEVBQUdHLGFBQWEsS0FBSzlGLEVBQU9HLDBCQUEyQixRQUM5RDRGLEVBQU9ILEVBQVNJLFFBQVFILEVBWFYsQ0FDaEJJLGFBQWMsd0JBQ2RDLFVBQVcsZ0JBQ1hDLGdCQUFpQixvQkFDakJDLEtBQU0sQ0FDSnJELElBQUsseUJBQ0xzRCxNQUFPLGdCQUNQQyxPQUFRLFlBTVp4RixFQUFJSSxLQUFLNkUsS0FFWGhKLEVBQU9ELFFBQVV1RCxHLGNDdEJqQnRELEVBQU9ELFFBQVVrQyxRQUFRLE8sY0NBekJqQyxFQUFPRCxRQUFVa0MsUUFBUSxhLGNDQXpCakMsRUFBT0QsUUFBVWtDLFFBQVEsVyxjQ0F6QmpDLEVBQU9ELFFBQVVrQyxRQUFRIiwiZmlsZSI6InNlcnZlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAyKTtcbiIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImNvbmZpZ1wiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJleHByZXNzXCIpOyIsImltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xyXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgcm91dGVzIGZyb20gJy4vcm91dGVzL2luZGV4JztcclxuaW1wb3J0ICogYXMgbW9yZ2FuIGZyb20gJ21vcmdhbic7XHJcbmltcG9ydCAqIGFzIGhlbG1ldCBmcm9tICdoZWxtZXQnOyAvLyBTZWN1cml0eVxyXG5cclxuY29uc3QgUE9SVCA9IGNvbmZpZy5wb3J0IHx8IDMwMDA7XHJcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcclxuXHJcbmFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xyXG5hcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcclxuXHJcbmlmIChjb25maWcuZW5hYmxlQWNjZXNzTG9ncykge1xyXG4gIGFwcC51c2UobW9yZ2FuKCd0aW55JykpO1xyXG59XHJcbmFwcC51c2UoaGVsbWV0KCkpO1xyXG5cclxuYXBwLnVzZShleHByZXNzLnN0YXRpYygncHVibGljJykpO1xyXG5cclxucm91dGVzKGFwcCk7XHJcblxyXG5hcHAubGlzdGVuKFBPUlQsICgpID0+IHtcclxuICBjb25zb2xlLmxvZygnc2VydmVyIHN0YXJ0ZWQgYXQgaHR0cDovL2xvY2FsaG9zdDonICsgUE9SVCk7XHJcbn0pO1xyXG4iLCJpbXBvcnQgKiBhcyBub2RlQ29uZmlnIGZyb20gJ2NvbmZpZyc7XHJcblxyXG5pbnRlcmZhY2UgQ29uZmlnIHtcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgbW9uZ29kYkNvbm5lY3Rpb25TdHJpbmc6IHN0cmluZztcclxuICBiYXNlUGF0aDogc3RyaW5nO1xyXG4gIGVuYWJsZUFjY2Vzc0xvZ3M6IGJvb2xlYW47XHJcbiAgcG9ydDogbnVtYmVyO1xyXG59XHJcblxyXG5jb25zdCBjb25maWc6IENvbmZpZyA9IHtcclxuICBuYW1lOiBub2RlQ29uZmlnLmdldDxzdHJpbmc+KCduYW1lJyksXHJcbiAgbW9uZ29kYkNvbm5lY3Rpb25TdHJpbmc6IG5vZGVDb25maWcuZ2V0PHN0cmluZz4oJ21vbmdvZGJDb25uZWN0aW9uU3RyaW5nJyksXHJcbiAgZW5hYmxlQWNjZXNzTG9nczogbm9kZUNvbmZpZy5nZXQ8Ym9vbGVhbj4oJ2VuYWJsZUFjY2Vzc0xvZ3MnKSxcclxuICBiYXNlUGF0aDogbm9kZUNvbmZpZy5nZXQ8c3RyaW5nPignYmFzZVBhdGgnKSxcclxuICBwb3J0OiBub2RlQ29uZmlnLmdldDxudW1iZXI+KCdwb3J0JyksXHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjb25maWc7XHJcbiIsImltcG9ydCB7IHJvdXRlciBhcyB1c2Vyc1JvdXRlIH0gZnJvbSAnLi91c2Vycyc7XHJcbmNvbnN0IGhvbWVSb3V0ZSA9IHJlcXVpcmUoJy4uL3JvdXRlcy9ob21lJyk7XHJcbmltcG9ydCB7IEV4cHJlc3MgfSBmcm9tICdleHByZXNzJztcclxuXHJcbi8vIGNvbnN0IHsgZXJyb3JNaWRMb2dnZXIgfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmUvbWlkRXJyb3JzJyk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoYXBwOiBFeHByZXNzKSB7XHJcbiAgYXBwLnVzZSgnL2FwaS91c2VycycsIHVzZXJzUm91dGUpO1xyXG4gIGFwcC51c2UoJy8nLCBob21lUm91dGUpO1xyXG5cclxuICAvLyAgIGFwcC51c2UoZXJyb3JNaWRMb2dnZXIpO1xyXG59XHJcbiIsImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xyXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcclxuXHJcbmNvbnN0IHsgbG9nZ2VyIH0gPSByZXF1aXJlKCcuLi9jb3JlL2xvZ2dlcicpO1xyXG5jb25zdCB7IEFETUlOLCBCQVNFIH0gPSByZXF1aXJlKCcuLi9jb3JlL3JvbGVzJyk7XHJcbmNvbnN0IGF1dGhQcm92aWRlciA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmUvYXV0aFByb3ZpZGVyJyk7XHJcbmNvbnN0IHVzZXJzU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3VzZXJzU2VydmljZScpO1xyXG4vLyBjb25zdCB7IHZhbGlkYXRlQ3JlYXRlVXNlciwgdmFsaWRhdGVFZGl0VXNlciB9ID0gcmVxdWlyZSgnLi4vc3RvcmUvdmFsaWRhdG9ycycpO1xyXG5jb25zdCBIdHRwRXJyb3IgPSByZXF1aXJlKCcuLi9zdG9yZS9tb2RlbHMvY29tbW9uLW1vZGVscycpO1xyXG5cclxucm91dGVyLmdldCgnLycsIGF1dGhQcm92aWRlcihbQURNSU4sIEJBU0VdKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgbG9nZ2VyLmluZm8oJ1lvdSBnZXQgYWxsIHVzZXJzIScpO1xyXG4gIGxldCByZXN1bHQgPSBhd2FpdCB1c2Vyc1NlcnZpY2UuZ2V0VXNlcnMoKTtcclxuICByZXMuc2VuZChyZXN1bHQpO1xyXG59KTtcclxucm91dGVyLmdldCgnLzppZCcsIGF1dGhQcm92aWRlcihbQURNSU4sIEJBU0VdKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgbGV0IHJlc3VsdCA9IGF3YWl0IHVzZXJzU2VydmljZS5nZXRVc2VyKHJlcS5wYXJhbXMuaWQpO1xyXG4gIGlmICghcmVzdWx0KSB0aHJvdyBuZXcgSHR0cEVycm9yKCdUaGUgdXNlciBub3QgZm91bmQuJywgNDA0KTtcclxuXHJcbiAgcmVzLnNlbmQocmVzdWx0KTtcclxufSk7XHJcbi8vIHJvdXRlci5wb3N0KCcvJywgYXV0aFByb3ZpZGVyKFtBRE1JTl0pLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuLy8gICBjb25zdCB7IGVycm9yIH0gPSB2YWxpZGF0ZUNyZWF0ZVVzZXIocmVxLmJvZHkpO1xyXG4vLyAgIGlmIChlcnJvcikgdGhyb3cgbmV3IEh0dHBFcnJvcihlcnJvci5kZXRhaWxzWzBdLm1lc3NhZ2UsIDQwMCk7XHJcblxyXG4vLyAgIGxldCByZXN1bHQgPSBhd2FpdCB1c2Vyc1NlcnZpY2UuY3JlYXRlVXNlcihyZXEuYm9keSk7XHJcbi8vICAgcmVzLnNlbmQocmVzdWx0KTtcclxuLy8gfSk7XHJcbi8vIHJvdXRlci5wdXQoJy86aWQnLCBhdXRoUHJvdmlkZXIoW0FETUlOXSksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4vLyAgIGNvbnN0IHsgZXJyb3IgfSA9IHZhbGlkYXRlRWRpdFVzZXIocmVxLmJvZHkpO1xyXG4vLyAgIGlmIChlcnJvcikgdGhyb3cgbmV3IEh0dHBFcnJvcihlcnJvci5kZXRhaWxzWzBdLm1lc3NhZ2UsIDQwMCk7XHJcblxyXG4vLyAgIGlmIChyZXEuYm9keS5faWQgIT0gcmVxLnBhcmFtcy5pZCkgdGhyb3cgbmV3IEh0dHBFcnJvcignVGhlIGJvZHkgX2lkIGRvZXMgbm90IG1hdGNoIHdpdGggVVJMIElEJywgNDAwKTtcclxuXHJcbi8vICAgbGV0IHJlc3VsdCA9IGF3YWl0IHVzZXJzU2VydmljZS5nZXRVc2VyKHJlcS5wYXJhbXMuaWQpO1xyXG4vLyAgIGlmICghcmVzdWx0KSB0aHJvdyBuZXcgSHR0cEVycm9yKCdUaGUgdXNlciBub3QgZm91bmQuJywgNDA0KTtcclxuXHJcbi8vICAgcmVzdWx0ID0gYXdhaXQgdXNlcnNTZXJ2aWNlLnVwZGF0ZVVzZXIocmVxLnBhcmFtcy5pZCwgcmVxLmJvZHkpO1xyXG4vLyAgIGlmIChyZXN1bHQub2spIHJlc3VsdCA9IGF3YWl0IHVzZXJzU2VydmljZS5nZXRVc2VyKHJlcS5wYXJhbXMuaWQpO1xyXG4vLyAgIHJlcy5zZW5kKHJlc3VsdCk7XHJcbi8vIH0pO1xyXG4vLyByb3V0ZXIuZGVsZXRlKCcvOmlkJywgYXV0aFByb3ZpZGVyKFtBRE1JTl0pLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuLy8gICBsZXQgcmVzdWx0ID0gYXdhaXQgdXNlcnNTZXJ2aWNlLmdldFVzZXIocmVxLnBhcmFtcy5pZCk7XHJcbi8vICAgaWYgKCFyZXN1bHQpIHRocm93IG5ldyBIdHRwRXJyb3IoJ1RoZSB1c2VyIG5vdCBmb3VuZC4nLCA0MDQpO1xyXG5cclxuLy8gICByZXN1bHQgPSBhd2FpdCB1c2Vyc1NlcnZpY2UuZGVsZXRlVXNlcihyZXEucGFyYW1zLmlkKTtcclxuLy8gICByZXMuc2VuZChyZXN1bHQpO1xyXG4vLyB9KTtcclxuZXhwb3J0IHsgcm91dGVyIH07XHJcbiIsImNvbnN0IHsgY3JlYXRlTG9nZ2VyLCB0cmFuc3BvcnRzLCBmb3JtYXQgfSA9IHJlcXVpcmUoJ3dpbnN0b24nKTtcclxuXHJcbmNvbnN0IHRyYW5zcG9ydEVycm9yID0gW1xyXG4gICAgbmV3IHRyYW5zcG9ydHMuRmlsZSh7XHJcbiAgICAgICAgbGV2ZWw6ICdpbmZvJyxcclxuICAgICAgICBmaWxlbmFtZTogJ2xvZ3Mvd2luc3Rvbi9lcnJvcnMubG9nJyxcclxuICAgICAgICBtYXhzaXplOiAzMDAwMDAwMCwgLy8gMzBNQlxyXG4gICAgICAgIHRhaWxhYmxlOiB0cnVlLFxyXG4gICAgICAgIG1heEZpbGVzOjNcclxuICAgIH0pLFxyXG4gICAgbmV3IHRyYW5zcG9ydHMuQ29uc29sZSh7XHJcbiAgICAgICAgZm9ybWF0OiBmb3JtYXQuc2ltcGxlKClcclxuICAgIH0pXHJcbl07XHJcbmNvbnN0IHRyYW5zcG9ydEluZm8gPSBbXHJcbiAgICBuZXcgdHJhbnNwb3J0cy5GaWxlKHtcclxuICAgICAgICBsZXZlbDogJ2luZm8nLFxyXG4gICAgICAgIGZpbGVuYW1lOiAnbG9ncy93aW5zdG9uL2luZm8ubG9nJyxcclxuICAgICAgICBtYXhzaXplOiAzMDAwMDAwMCwgLy8gMzBNQlxyXG4gICAgICAgIHRhaWxhYmxlOiB0cnVlLFxyXG4gICAgICAgIG1heEZpbGVzOjNcclxuICAgIH0pLFxyXG4gICAgbmV3IHRyYW5zcG9ydHMuQ29uc29sZSh7XHJcbiAgICAgICAgZm9ybWF0OiBmb3JtYXQuc2ltcGxlKClcclxuICAgIH0pXHJcbl07XHJcbmNvbnN0IGxvZ2dlckVycm9yID0gY3JlYXRlTG9nZ2VyKHtcclxuICAgIGZvcm1hdDogZm9ybWF0LmNvbWJpbmUoXHJcbiAgICAgICAgZm9ybWF0LnByaW50ZihlcnIgPT4gZXJyLm1lc3NhZ2UpXHJcbiAgICApLFxyXG4gICAgdHJhbnNwb3J0czogdHJhbnNwb3J0RXJyb3JcclxufSk7XHJcbmNvbnN0IGxvZ2dlckluZm8gPSBjcmVhdGVMb2dnZXIoe1xyXG4gICAgZm9ybWF0OiBmb3JtYXQuY29tYmluZShcclxuICAgICAgICBmb3JtYXQucHJpbnRmKGluZm8gPT4gaW5mby5tZXNzYWdlKVxyXG4gICAgKSxcclxuICAgIHRyYW5zcG9ydHM6IHRyYW5zcG9ydEluZm9cclxufSk7XHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgbG9nZ2VyOiB7XHJcbiAgICAgICAgaW5mbyhtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlckluZm8uaW5mbyhtZXNzYWdlICsgXCIgfCBcIiArIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvcihlcnIpIHtcclxuICAgICAgICAgICAgbG9nZ2VyRXJyb3IuZXJyb3IoZXJyLm1lc3NhZ2UsIHtcclxuICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlIHx8IFwiNTAwXCIsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHJlcS51cmwgfHwgXCJcIixcclxuICAgICAgICAgICAgICAgIHN0YWNrOiBlcnIuc3RhY2tcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwid2luc3RvblwiKTsiLCJjb25zdCByb2xlcyA9IHtcclxuICAgIEFETUlOOiBcIkFETUlOXCIsXHJcbiAgICBCQVNFOiBcIkJBU0VcIlxyXG59XHJcbm1vZHVsZS5leHBvcnRzID0gcm9sZXM7IiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBhdXRoUHJvdmlkZXIodmFsaWRSb2xlcykge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIGF1dGgocmVxLCByZXMsIG5leHQpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdBdXRoZW50aWNhdGluZy4uLicsIHZhbGlkUm9sZXMpO1xyXG4gICAgICAgIG5leHQoKTtcclxuICAgIH1cclxufTsiLCJcclxuY29uc3QgZGJDb250ZXh0ID0gcmVxdWlyZShcIi4uL3N0b3JlL2RiQ29udGV4dFwiKTtcclxuXHJcbmNsYXNzIFVzZXJzU2VydmljZSB7XHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuICBhc3luYyBnZXRVc2VycyAoKSB7XHJcbiAgICByZXR1cm4gYXdhaXQgZGJDb250ZXh0LlVzZXIuZmluZCgpXHJcbiAgICAgIC8vIC5maW5kKHsgcHJpY2U6IHsgJGd0ZTogMTAgfSB9KVxyXG4gICAgICAvLyAuZmluZCh7IHByaWNlOiB7ICRpbjogWzEwLCAxNSwgMjBdIH0gfSlcclxuICAgICAgLy8gLm9yKFsgeyBwcmljZTogeyAkaW46IFsxMCwgMTUsIDIwXSB9IH0sIHsgcHJpY2U6IG51bGwgfSBdKVxyXG4gICAgICAvLyAuYW5kKFsgeyBwcmljZTogeyAkaW46IFsxMCwgMTUsIDIwXSB9IH0sIHsgcHJpY2U6IG51bGwgfSBdKVxyXG4gICAgICAvLyAuZmluZCgpXHJcbiAgICAgIC8vIC5zb3J0KHsgbmFtZTogMSB9KVxyXG4gICAgICAvLy5zZWxlY3QoeyBuYW1lOiAxLCB0YWdzOiAxIH0pXHJcbiAgICAgIC5saW1pdCgxMCk7XHJcbiAgfTtcclxuICBhc3luYyBnZXRVc2VyIChpZCkge1xyXG4gICAgcmV0dXJuIGF3YWl0IGRiQ29udGV4dC5Vc2VyLmZpbmRPbmUoeyBfaWQ6IGlkIH0pO1xyXG4gIH07XHJcbiAgYXN5bmMgY3JlYXRlVXNlciAodXNlcikge1xyXG4gICAgdXNlci5jcmVhdGlvbkRhdGUgPSBEYXRlLm5vdygpO1xyXG4gICAgbGV0IF91c2VyID0gbmV3IGRiQ29udGV4dC5Vc2VyKHVzZXIpO1xyXG4gICAgcmV0dXJuIGF3YWl0IF91c2VyLnNhdmUoKTtcclxuICB9O1xyXG4gIGFzeW5jIHVwZGF0ZVVzZXIgKGlkLCB1c2VyKSB7XHJcbiAgICB1c2VyLm1vZGlmaWNhdGlvbkRhdGUgPSBEYXRlLm5vdygpO1xyXG4gICAgcmV0dXJuIGF3YWl0IGRiQ29udGV4dC5Vc2VyLnVwZGF0ZU9uZSh7IF9pZDogaWQgfSwgdXNlcik7XHJcbiAgfTtcclxuICBhc3luYyBkZWxldGVVc2VyIChpZCkge1xyXG4gICAgcmV0dXJuIGF3YWl0IGRiQ29udGV4dC5Vc2VyLmRlbGV0ZU9uZSh7IF9pZDogaWQgfSk7XHJcbiAgfTtcclxufVxyXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBVc2Vyc1NlcnZpY2UoKTtcclxuIiwiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKFwibW9uZ29vc2VcIik7XHJcbmNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoXCJjb25maWdcIik7XHJcblxyXG5jb25zdCBjb25uZWN0aW9uU3RyaW5nID0gY29uZmlnLm1vbmdvZGJDb25uZWN0aW9uU3RyaW5nIHx8IFwibW9uZ29kYjovL2xvY2FsaG9zdC9cIjtcclxuY29uc29sZS5sb2coY29ubmVjdGlvblN0cmluZyk7XHJcbmNvbnN0IGRiTmFtZSA9ICdBdXRoUHJvdmlkZXInO1xyXG5cclxuLy8gbW9uZ29vc2UuY29ubmVjdGlvbi5yZWFkeVN0YXRlOlxyXG4vLyAwOiBkaXNjb25uZWN0ZWRcclxuLy8gMTogY29ubmVjdGVkXHJcbi8vIDI6IGNvbm5lY3RpbmdcclxuLy8gMzogZGlzY29ubmVjdGluZ1xyXG5kYiA9IG1vbmdvb3NlLmNvbm5lY3Rpb247XHJcbmRiLm9uKCdjb25uZWN0aW5nJywgZnVuY3Rpb24oKSB7XHJcbiAgY29uc29sZS5sb2coJ2Nvbm5lY3RpbmcgdG8gTW9uZ29EQi4uLicpO1xyXG59KTtcclxuZGIub24oJ2Vycm9yJywgZnVuY3Rpb24oZXJyb3IpIHtcclxuICBjb25zb2xlLmxvZygnRXJyb3IgaW4gTW9uZ29EYiBjb25uZWN0aW9uOiAnICsgZXJyb3IpO1xyXG59KTtcclxuZGIub24oJ2Nvbm5lY3RlZCcsIGZ1bmN0aW9uKCkge1xyXG4gIGNvbnNvbGUubG9nKCdNb25nb0RCIGNvbm5lY3RlZCEnKTtcclxufSk7XHJcbmRiLm9uY2UoJ29wZW4nLCBmdW5jdGlvbigpIHtcclxuICBjb25zb2xlLmxvZygnTW9uZ29EQiBjb25uZWN0aW9uIG9wZW5lZCEnKTtcclxufSk7XHJcbmRiLm9uKCdyZWNvbm5lY3RlZCcsIGZ1bmN0aW9uICgpIHtcclxuICBjb25zb2xlLmxvZygnTW9uZ29EQiByZWNvbm5lY3RlZCEnKTtcclxufSk7XHJcbmRiLm9uKCdkaXNjb25uZWN0ZWQnLCBmdW5jdGlvbigpIHtcclxuICBjb25zb2xlLmxvZygnTW9uZ29EQiBkaXNjb25uZWN0ZWQhJyk7XHJcbn0pO1xyXG5cclxubW9uZ29vc2UuY29ubmVjdChjb25uZWN0aW9uU3RyaW5nICsgZGJOYW1lLCB7XHJcbiAgcmVjb25uZWN0VHJpZXM6IE51bWJlci5NQVhfVkFMVUUsIC8vIE5ldmVyIHN0b3AgdHJ5aW5nIHRvIHJlY29ubmVjdFxyXG4gIHJlY29ubmVjdEludGVydmFsOiA1MDAwLCAvLyBSZWNvbm5lY3QgZXZlcnkgNTAwMG1zXHJcbiAgdXNlTmV3VXJsUGFyc2VyOiB0cnVlXHJcbn0pO1xyXG5cclxuLy8gc2NoZW1hc1xyXG5jb25zdCB1c2VyU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XHJcbiAgZmlyc3ROYW1lOiBTdHJpbmcsXHJcbiAgbGFzdE5hbWU6IFN0cmluZyxcclxuICBlbWFpbDogU3RyaW5nLFxyXG4gIGlzQWN0aXZlOiBCb29sZWFuLFxyXG4gIG1vZGlmaWNhdGlvbkRhdGU6IHsgdHlwZTogRGF0ZSwgZGVmYXVsdDogbnVsbCB9LFxyXG4gIGNyZWF0aW9uRGF0ZTogeyB0eXBlOiBEYXRlIH1cclxufSk7XHJcbmNvbnN0IFVzZXIgPSBtb25nb29zZS5tb2RlbChcIlVzZXJcIiwgdXNlclNjaGVtYSwgXCJ1c2Vyc1wiKTsgXHJcbi8vIG1vZGVsXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIFVzZXJcclxufTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJtb25nb29zZVwiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IGNsYXNzIEh0dHBFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHN0YXR1c0NvZGUpIHtcclxuICAgICAgICBzdXBlcihtZXNzYWdlKTtcclxuICAgICAgICB0aGlzLnN0YXR1c0NvZGU9IHN0YXR1c0NvZGUgfHwgNTAwO1xyXG4gICAgfVxyXG59IiwiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxudmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxudmFyIG11c3RhY2hlID0gcmVxdWlyZSgnbXVzdGFjaGUnKTtcclxuY29uc3QgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XHJcblxyXG5yb3V0ZXIuZ2V0KCcvJywgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3Qgdmlld01vZGVsID0ge1xyXG4gICAgcGFnZVBvc1RpdGxlOiAndGl0b2xvIHBvc2l6aW9uYW1lbnRvJyxcclxuICAgIHBhZ2VUaXRsZTogJ3RpdG9sbyBwYWdpbmEnLFxyXG4gICAgcGFnZURlc2NyaXB0aW9uOiAndGl0b2xvIGRlc3JpemlvbmUnLFxyXG4gICAgbGluazoge1xyXG4gICAgICB1cmw6ICdodHRwczovL3d3dy5nb29nbGUuaXQvJyxcclxuICAgICAgbGFiZWw6ICdsaW5rIGEgZ29vZ2xlJyxcclxuICAgICAgdGFyZ2V0OiAnX2JsYW5rJyxcclxuICAgIH0sXHJcbiAgfTtcclxuICB2YXIgcGFnZSA9IGZzLnJlYWRGaWxlU3luYyhgLi8ke2NvbmZpZy5iYXNlUGF0aH12aWV3cy9ob21lLmh0bWxgLCAndXRmOCcpOyAvL1RPRE8gbWV0dGVyZSBxdWFsY29zYSBkaSByZWxhdGl2byBvIHVuIHNldHRhZ2dpbyBjb25maWdcclxuICB2YXIgaHRtbCA9IG11c3RhY2hlLnRvX2h0bWwocGFnZSwgdmlld01vZGVsKTtcclxuXHJcbiAgcmVzLnNlbmQoaHRtbCk7XHJcbn0pO1xyXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcclxuIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiZnNcIik7IiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwibXVzdGFjaGVcIik7IiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwibW9yZ2FuXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImhlbG1ldFwiKTsiXSwic291cmNlUm9vdCI6IiJ9